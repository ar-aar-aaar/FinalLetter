<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Descenso</title>

  <!-- Tipografías (opcional, con fallback si no carga) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700;900&family=Cormorant+Garamond:ital,wght@0,500;0,700;1,600&display=swap"
    rel="stylesheet">

  <style>
    :root {
      --bg0: #0b0506;
      --bg1: #180606;
      --bg2: #2a0b07;
      --paper: #f3e7df;
      --muted: #d0bfb5;
      --red: #ff2a2a;
      --red2: #b31217;
      --gold: #e2b074;
      --shadow: rgba(0, 0, 0, .55);

      --playerH: 74px;
      --safeB: env(safe-area-inset-bottom, 0px);
      --safeT: env(safe-area-inset-top, 0px);
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      background: radial-gradient(1200px 900px at 50% -10%, #3a0f0b 0%, var(--bg1) 45%, var(--bg0) 100%);
      color: var(--paper);
      overflow: hidden;
      /* lo controlamos nosotros */
      font-family: "Cormorant Garamond", ui-serif, Georgia, "Times New Roman", serif;
    }

    /* Sutil “ceniza” */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: .11;
      background-image:
        radial-gradient(circle at 20% 30%, rgba(255, 255, 255, .08) 0 1px, transparent 2px),
        radial-gradient(circle at 60% 70%, rgba(255, 255, 255, .06) 0 1px, transparent 2px),
        radial-gradient(circle at 80% 20%, rgba(255, 255, 255, .05) 0 1px, transparent 2px);
      background-size: 220px 260px, 280px 320px, 340px 420px;
      animation: ash 12s linear infinite;
      filter: blur(.2px);
    }

    @keyframes ash {
      0% {
        transform: translateY(0);
      }

      100% {
        transform: translateY(40px);
      }
    }

    /* Gate (pantalla inicial) */
    #gate {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      padding: 24px;
      background:
        radial-gradient(800px 600px at 50% 30%, rgba(255, 42, 42, .15) 0%, rgba(0, 0, 0, .0) 55%),
        radial-gradient(900px 700px at 50% 90%, rgba(226, 176, 116, .10) 0%, rgba(0, 0, 0, .0) 60%),
        linear-gradient(180deg, #110506 0%, #080304 100%);
      z-index: 50;
    }

    .gateCard {
      width: min(720px, 100%);
      padding: 22px 18px;
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, .10);
      background: rgba(10, 5, 6, .55);
      box-shadow: 0 18px 55px rgba(0, 0, 0, .55);
      backdrop-filter: blur(10px);
    }

    .gateTitle {
      font-family: "Cinzel", serif;
      letter-spacing: .06em;
      margin: 0 0 10px 0;
      font-size: clamp(22px, 3.8vw, 34px);
    }

    .gateLead {
      margin: 0 0 18px 0;
      color: var(--muted);
      line-height: 1.5;
      font-size: clamp(14px, 2.6vw, 16px);
    }

    .gateQ {
      margin: 0 0 18px 0;
      font-size: clamp(18px, 3.2vw, 22px);
      line-height: 1.25;
    }

    .gateActions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: flex-end;
      padding-top: 6px;
    }

    /* =========================
   GATE: CTA ceremonial (no botón)
   ========================= */
    .gateActionsOne {
      justify-content: flex-start;
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
    }

    .oathLine {
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
    }

    .oathSeal {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: radial-gradient(circle at 35% 35%, rgba(255, 255, 255, .22) 0%, rgba(255, 255, 255, 0) 45%),
        radial-gradient(circle at 50% 50%, rgba(255, 42, 42, .95) 0%, rgba(179, 18, 23, .92) 70%, rgba(0, 0, 0, 0) 100%);
      box-shadow:
        0 0 18px rgba(255, 42, 42, .30),
        0 0 45px rgba(255, 42, 42, .10);
      animation: sealPulse 1.9s ease-in-out infinite;
    }

    @keyframes sealPulse {

      0%,
      100% {
        transform: scale(1);
        filter: brightness(1);
      }

      50% {
        transform: scale(1.12);
        filter: brightness(1.12);
      }
    }

    .oathLink {
      display: inline-block;
      text-decoration: none;
      color: rgba(245, 235, 228, .96);
      font-size: clamp(18px, 3.5vw, 22px);
      line-height: 1.25;
      letter-spacing: .02em;

      /* “firma” */
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, .14);
      position: relative;

      text-shadow: 0 14px 40px rgba(0, 0, 0, .55);
      transition: transform .18s ease, color .18s ease, border-color .18s ease, filter .18s ease;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .oathLink::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      bottom: -2px;
      height: 1px;
      background: linear-gradient(90deg, rgba(255, 42, 42, 0) 0%, rgba(255, 42, 42, .65) 35%, rgba(255, 42, 42, 0) 100%);
      opacity: .65;
      filter: blur(.2px);
      transform: scaleX(.55);
      transform-origin: 0 50%;
      transition: transform .22s ease, opacity .22s ease;
    }

    .oathLink:active {
      transform: translateY(1px);
      filter: brightness(1.08);
    }

    .oathLink:hover {
      color: #fff;
      border-bottom-color: rgba(255, 255, 255, .22);
    }

    .oathLink:hover::after {
      transform: scaleX(1);
      opacity: .95;
    }

    .oathEm {
      color: var(--red);
      font-weight: 800;
      letter-spacing: .04em;
    }

    .oathHint {
      font-size: 13px;
      opacity: .8;
    }


    .shake {
      animation: shake .35s ease;
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-6px);
      }

      50% {
        transform: translateX(6px);
      }

      75% {
        transform: translateX(-4px);
      }
    }

    /* Stage */
    #app {
      position: fixed;
      inset: 0;
      display: grid;
      grid-template-rows: 1fr var(--playerH);
      padding-bottom: calc(var(--safeB));
    }

    #stage {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: clamp(18px, 5vw, 44px);
      padding-top: calc(clamp(18px, 5vw, 44px) + var(--safeT));
      padding-bottom: calc(clamp(18px, 5vw, 44px) + var(--playerH) + var(--safeB));
      overflow: hidden;
    }

    #stage {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: clamp(18px, 5vw, 44px);
      padding-top: calc(clamp(18px, 5vw, 44px) + var(--safeT));
      padding-bottom: calc(clamp(18px, 5vw, 44px) + var(--playerH) + var(--safeB));
      overflow: hidden;
    }

    /* “Spotlight” teatral suave (sin tarjeta flotante) */
    #stage::before {
      content: "";
      position: absolute;
      inset: -20%;
      background:
        radial-gradient(520px 520px at 50% 40%, rgba(255, 255, 255, .06) 0%, rgba(0, 0, 0, 0) 60%),
        radial-gradient(900px 700px at 50% 20%, rgba(255, 42, 42, .10) 0%, rgba(0, 0, 0, 0) 55%),
        radial-gradient(900px 700px at 50% 95%, rgba(226, 176, 116, .07) 0%, rgba(0, 0, 0, 0) 60%);
      filter: blur(.2px);
      pointer-events: none;
    }

    .stageInner {
      width: min(860px, 92vw);
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 14px;
      text-align: center;
      padding: 6px 6px;
    }

    /* Modo “solo título” */
    .stageInner.titleOnly #para {
      display: none;
    }

    .stageInner.titleOnly #hint {
      display: none;
    }

    /* =========================
   TEXTO PROYECTADO (PROYECTOR)
   ========================= */

    /* quitamos centrado rígido para que el “proyector” se sienta real */
    .stageInner {
      text-align: left;
      align-items: flex-start;
    }

    /* bloque de proyección */
    .stageInner {
      transform: perspective(1200px) rotateX(6deg) rotateY(-5deg);
      transform-origin: 20% 40%;
    }

    /* Haz / polvo / grano del proyector */
    #stage::after {
      content: "";
      position: absolute;
      inset: -20%;
      pointer-events: none;
      background:
        radial-gradient(900px 520px at 30% 40%, rgba(255, 255, 255, .07) 0%, rgba(0, 0, 0, 0) 62%),
        radial-gradient(900px 520px at 35% 55%, rgba(255, 42, 42, .06) 0%, rgba(0, 0, 0, 0) 65%),
        repeating-linear-gradient(0deg,
          rgba(255, 255, 255, .018) 0px,
          rgba(255, 255, 255, .018) 1px,
          rgba(0, 0, 0, 0) 3px,
          rgba(0, 0, 0, 0) 6px);
      mix-blend-mode: screen;
      opacity: .55;
      filter: blur(.35px);
      animation: projectorFlicker 3.8s ease-in-out infinite;
    }

    @keyframes projectorFlicker {

      0%,
      100% {
        opacity: .48;
        transform: translateY(0);
      }

      50% {
        opacity: .62;
        transform: translateY(1px);
      }
    }

    /* Letras con “glow” de proyección */
    .actTitle {
      text-shadow:
        0 18px 55px rgba(255, 42, 42, .14),
        0 0 22px rgba(255, 42, 42, .18);
    }

    .para {
      color: rgba(245, 235, 228, .92);
      text-shadow:
        0 14px 40px rgba(0, 0, 0, .60),
        0 0 18px rgba(255, 255, 255, .06);
      filter: contrast(1.04);
    }

    /* Suaviza la entrada para que parezca “encender proyector” */
    .fadeIn {
      animation: projectedIn .65s cubic-bezier(.2, .9, .2, 1) both;
    }

    @keyframes projectedIn {
      from {
        opacity: 0;
        transform: translateY(18px) skewX(-2deg);
        filter: blur(10px) brightness(.9);
      }

      to {
        opacity: 1;
        transform: translateY(0) skewX(0deg);
        filter: blur(0) brightness(1);
      }
    }



    .actMeta {
      color: rgba(226, 176, 116, .88);
      letter-spacing: .12em;
      text-transform: uppercase;
      font-size: 12px;
      margin-bottom: 2px;
    }

    .actTitle {
      font-family: "Cinzel Decorative", serif;
      margin: 0;
      line-height: 1.03;
      letter-spacing: .08em;
      text-transform: uppercase;
      font-size: clamp(30px, 6vw, 56px);
      color: var(--red);
      text-shadow: 0 18px 55px rgba(255, 42, 42, .14);
      text-align: center;
    }


    .para {
      margin: 0;
      line-height: 1.78;
      font-size: clamp(18px, 4.2vw, 22px);
      color: rgba(245, 235, 228, .96);
      text-shadow: 0 14px 40px rgba(0, 0, 0, .55);
    }

    .accent {
      color: var(--red);
      font-weight: 750;
    }

    .soft {
      color: var(--muted);
    }

    /* Hint de scroll */
    .hint {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: rgba(255, 255, 255, .62);
      font-size: 13px;
      user-select: none;
    }

    .mouse {
      width: 18px;
      height: 28px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, .35);
      position: relative;
    }

    .mouse::after {
      content: "";
      position: absolute;
      left: 50%;
      top: 6px;
      width: 3px;
      height: 6px;
      border-radius: 4px;
      background: rgba(255, 255, 255, .55);
      transform: translateX(-50%);
      animation: wheel 1.2s ease-in-out infinite;
    }

    @keyframes wheel {
      0% {
        transform: translate(-50%, 0);
        opacity: .85;
      }

      70% {
        transform: translate(-50%, 10px);
        opacity: .1;
      }

      100% {
        opacity: .0;
      }
    }

    /* Animación de entrada de texto */
    .fadeIn {
      animation: fadeInUp .55s cubic-bezier(.2, .8, .2, 1) both;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(14px);
        filter: blur(6px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
        filter: blur(0);
      }
    }

    /* Cortinas */
    #curtains {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 60;
      display: flex;
    }

    .curtain {
      width: 50%;
      height: 100%;
      background:
        radial-gradient(90% 70% at 50% 30%, rgba(255, 42, 42, .16) 0%, rgba(0, 0, 0, 0) 62%),
        linear-gradient(180deg, #2b0707 0%, #140405 55%, #060203 100%),
        linear-gradient(90deg, rgba(255, 255, 255, .04) 0%, rgba(0, 0, 0, .20) 50%, rgba(255, 255, 255, .04) 100%);
      box-shadow: inset 0 0 90px rgba(0, 0, 0, .62);
      transform: translateX(0);
      will-change: transform;
      transition: transform .72s cubic-bezier(.2, .9, .2, 1);
    }

    .curtain.left {
      transform: translateX(-105%);
    }

    .curtain.right {
      transform: translateX(105%);
    }

    body.curtainsClosing .curtain.left {
      transform: translateX(0);
    }

    body.curtainsClosing .curtain.right {
      transform: translateX(0);
    }

    .curtain {
      transition: transform .72s cubic-bezier(.2, .9, .2, 1);
    }

    /* Sombra central cuando cierran */
    #curtainSeam {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 61;
      opacity: 0;
      background: radial-gradient(60% 100% at 50% 50%, rgba(0, 0, 0, .55) 0%, rgba(0, 0, 0, 0) 60%);
      transition: opacity .4s ease;
    }

    body.curtainsClosing #curtainSeam {
      opacity: 1;
    }

    /* Llamas + black out */
    #burn {
      position: fixed;
      inset: 0;
      z-index: 80;
      display: none;
      background: rgba(0, 0, 0, 0);
    }

    #burn.show {
      display: block;
    }

    #flameCanvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    #burnFade {
      position: absolute;
      inset: 0;
      background: #000;
      opacity: 0;
      transition: opacity 1.2s ease;
    }

    #burn.black #burnFade {
      opacity: 1;
    }

    /* Cielo nocturno */
    #night {
      position: fixed;
      inset: 0;
      z-index: 90;
      display: none;
      background: #000;
      overflow: hidden;
    }

    #night.show {
      display: block;
    }

    #skyCanvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
      /* <-- arriba del glow */
    }

    #nightGlow {
      position: absolute;
      inset: 0;
      z-index: 1;
      /* <-- abajo del canvas */
      pointer-events: none;
      opacity: 0;
      background:
        radial-gradient(900px 700px at 50% 75%, rgba(60, 120, 255, .14) 0%, rgba(0, 0, 0, 0) 60%),
        radial-gradient(900px 600px at 70% 20%, rgba(80, 130, 255, .10) 0%, rgba(0, 0, 0, 0) 55%),
        radial-gradient(900px 700px at 25% 15%, rgba(60, 120, 255, .08) 0%, rgba(0, 0, 0, 0) 55%),
        linear-gradient(180deg, rgba(0, 0, 0, .0) 0%, rgba(4, 11, 24, .55) 100%);
      /* <-- NO opaco */
      transition: opacity 2.2s ease;
    }

    #night.show #nightGlow {
      opacity: 1;
    }

    #moon {
      position: absolute;
      width: min(260px, 42vw);
      aspect-ratio: 1 / 1;
      left: 50%;
      top: 26%;
      transform: translate(-50%, -20px) scale(.94);
      opacity: 0;
      filter: drop-shadow(0 22px 45px rgba(0, 0, 0, .7));
      animation: moonIn 2.2s cubic-bezier(.2, .9, .2, 1) 1.1s forwards;
      z-index: 3;
    }

    @keyframes moonIn {
      to {
        opacity: 1;
        transform: translate(-50%, 0) scale(1);
      }
    }

    #quote {
      position: absolute;
      left: 50%;
      top: 68%;
      transform: translateX(-50%);
      width: min(820px, 92vw);
      text-align: center;
      opacity: 0;
      animation: quoteIn 1.8s ease 2.0s forwards;
      padding: 0 10px;
      z-index: 3;
    }

    @keyframes quoteIn {
      to {
        opacity: 1;
      }
    }

    #quote .hand {
      font-family: "Dancing Script", "Segoe Script", "Brush Script MT", cursive;
      font-size: clamp(22px, 5.2vw, 44px);
      color: rgba(232, 244, 255, .92);
      text-shadow: 0 12px 36px rgba(0, 0, 0, .65);
      line-height: 1.12;
    }

    /* Player */
    #player {
      position: fixed;
      left: 12px;
      right: 12px;
      bottom: 12px;
      height: calc(var(--playerH) + var(--safeB));
      padding-bottom: var(--safeB);
      z-index: 40;

      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, .14);
      background:
        radial-gradient(900px 240px at 50% 0%, rgba(255, 255, 255, .08) 0%, rgba(0, 0, 0, 0) 60%),
        radial-gradient(900px 220px at 50% 0%, rgba(255, 42, 42, .10) 0%, rgba(0, 0, 0, 0) 60%),
        rgba(6, 3, 4, .82);

      backdrop-filter: blur(16px);
      display: flex;
      align-items: center;
      gap: 12px;
      padding-left: 14px;
      padding-right: 14px;

      box-shadow:
        0 18px 50px rgba(0, 0, 0, .60),
        0 0 0 rgba(255, 255, 255, .0);

      animation: playerPulse 2.2s ease-in-out infinite;
    }

    @keyframes playerPulse {

      0%,
      100% {
        box-shadow:
          0 18px 50px rgba(0, 0, 0, .60),
          0 0 12px rgba(255, 255, 255, .08);
      }

      50% {
        box-shadow:
          0 20px 58px rgba(0, 0, 0, .62),
          0 0 18px rgba(255, 255, 255, .13);
      }
    }


    .thumb {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      background: rgba(255, 255, 255, .06);
      border: 1px solid rgba(255, 255, 255, .12);
      flex: 0 0 auto;
      overflow: hidden;
    }

    .thumb svg {
      width: 36px;
      height: 36px;
    }

    .track {
      flex: 1 1 auto;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .marquee {
      position: relative;
      overflow: hidden;
      white-space: nowrap;
      mask-image: linear-gradient(90deg, transparent 0%, black 10%, black 90%, transparent 100%);
      -webkit-mask-image: linear-gradient(90deg, transparent 0%, black 10%, black 90%, transparent 100%);
    }

    .marqueeInner {
      display: inline-flex;
      gap: 36px;
      align-items: center;
      will-change: transform;
      animation: marquee 10s linear infinite;
    }

    @keyframes marquee {
      0% {
        transform: translateX(0);
      }

      100% {
        transform: translateX(-50%);
      }
    }

    .songTitle {
      font-weight: 800;
      letter-spacing: .02em;
      font-size: 14px;
      color: rgba(255, 255, 255, .94);
    }

    .songSub {
      font-size: 12px;
      color: rgba(255, 255, 255, .55);
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 0 0 auto;
    }

    .iconBtn {
      width: 42px;
      height: 42px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, .16);
      background: rgba(255, 255, 255, .06);
      display: grid;
      place-items: center;
      cursor: pointer;
      transition: transform .15s ease, background .2s ease;
    }

    .iconBtn:active {
      transform: scale(.98);
    }

    .iconBtn svg {
      width: 18px;
      height: 18px;
      fill: rgba(255, 255, 255, .92);
    }

    .progressWrap {
      width: min(220px, 32vw);
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-end;
    }

    .bar {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(255, 255, 255, .12);
      overflow: hidden;
      cursor: pointer;
      border: 1px solid rgba(0, 0, 0, .18);
    }

    .barFill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--red) 0%, rgba(255, 255, 255, .92) 100%);
    }

    .time {
      font-size: 11px;
      color: rgba(255, 255, 255, .58);
      letter-spacing: .06em;
    }

    /* Ajustes móviles */
    @media (max-width: 420px) {
      .progressWrap {
        display: none;
      }

      .songSub {
        display: none;
      }

      .thumb {
        width: 42px;
        height: 42px;
        border-radius: 12px;
      }
    }

    /* =========================
   GATE: corazón realista + latido + tinta
   ========================= */

    /* el gateCard debe permitir overlay de la tinta */
    .gateCard {
      position: relative;
      overflow: hidden;
    }

    /* sello: ahora es contenedor del SVG corazón */
    .oathSeal {
      width: 28px;
      height: 28px;
      display: grid;
      place-items: center;
      flex: 0 0 auto;
      filter: drop-shadow(0 0 18px rgba(255, 42, 42, .22)) drop-shadow(0 0 45px rgba(255, 42, 42, .10));
      animation: sealPulse 1.9s ease-in-out infinite;
    }

    .oathHeart {
      width: 28px;
      height: 28px;
    }

    /* brillo del corazón “respira” */
    .heartSheen {
      transform-origin: 50% 50%;
      animation: sheenMove 1.9s ease-in-out infinite;
    }

    @keyframes sheenMove {

      0%,
      100% {
        opacity: .45;
        transform: translateX(-1px) translateY(0) scale(1);
      }

      50% {
        opacity: .75;
        transform: translateX(1px) translateY(-.5px) scale(1.02);
      }
    }

    @keyframes sealPulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.10);
      }
    }

    /* Latido del texto (sin romper :active del link) */
    .oathText {
      display: inline-block;
      animation: oathBeat 1.9s ease-in-out infinite;
      transform-origin: 0% 50%;
    }

    @keyframes oathBeat {

      0%,
      100% {
        transform: translateY(0) scale(1);
        filter: brightness(1);
      }

      40% {
        transform: translateY(-.3px) scale(1.012);
        filter: brightness(1.06);
      }

      55% {
        transform: translateY(0) scale(1);
        filter: brightness(1);
      }
    }

    /* Tinta: invisible hasta “firmar” */
    .inkSig {
      position: absolute;
      left: 18px;
      right: 18px;
      bottom: 86px;
      height: 76px;
      opacity: 0;
      pointer-events: none;
      transform: translateY(6px);
    }

    /* Prepara paths para animación tipo “firma” */
    .inkMain,
    .inkFat {
      stroke-dasharray: 2000;
      stroke-dashoffset: 2000;
    }

    .gateCard.signing .inkSig {
      opacity: 1;
      transform: translateY(0);
      transition: opacity .12s ease, transform .22s ease;
    }

    .gateCard.signing .inkFat {
      animation: inkDraw .62s cubic-bezier(.2, .9, .2, 1) forwards;
    }

    .gateCard.signing .inkMain {
      animation: inkDraw .62s cubic-bezier(.2, .9, .2, 1) forwards;
    }

    @keyframes inkDraw {
      to {
        stroke-dashoffset: 0;
      }
    }

    /* micro-flash rojo dramático al firmar */
    .gateCard.signing::after {
      content: "";
      position: absolute;
      inset: -10%;
      background: radial-gradient(520px 320px at 35% 55%, rgba(255, 42, 42, .14) 0%, rgba(0, 0, 0, 0) 62%);
      opacity: .9;
      filter: blur(1px);
      animation: signFlash .65s ease forwards;
      pointer-events: none;
    }

    @keyframes signFlash {
      0% {
        opacity: .0;
        transform: translateY(2px);
      }

      25% {
        opacity: .9;
      }

      100% {
        opacity: 0;
        transform: translateY(0);
      }
    }
  </style>
</head>

<body>
  <!-- Cortinas -->
  <div id="curtains" aria-hidden="true">
    <div class="curtain left"></div>
    <div class="curtain right"></div>
  </div>
  <div id="curtainSeam" aria-hidden="true"></div>

  <!-- Gate -->
  <section id="gate" role="dialog" aria-modal="true">
    <div class="gateCard" id="gateCard">
      <h1 class="gateTitle">Antes de cualquier cosa…</h1>
      <p class="gateLead">
        Honestamente, había pensado en no mandarte esto y como dijiste,
        <span class="accent">prenderle fuego a la carta</span>, pero algo dentro de mí
        me hizo cambiar de opinión y luego de un par de modificaciones, aquí estamos, <span class="accent">la última
          carta</span>. Con las referencias que me faltaban hacer.
        Esto será una obra teatral llena de drama. Cada scroll es un paso más abajo.
        Y al fondo… el infierno.
      </p>
      <p class="gateQ">Así como siempre te dije, "dónde sea por verte y al <span class="accent">infierno por
          tenerte</span>"</p>
      <div class="gateActions gateActionsOne">
        <div class="oathLine">
          <span class="oathSeal" aria-hidden="true">
            <!-- Corazón “realista” (SVG) -->
            <svg class="oathHeart" viewBox="0 0 64 64" aria-hidden="true">
              <defs>
                <radialGradient id="hg" cx="30%" cy="25%" r="80%">
                  <stop offset="0%" stop-color="#ffb3b3" stop-opacity=".55" />
                  <stop offset="38%" stop-color="#ff2a2a" stop-opacity=".55" />
                  <stop offset="100%" stop-color="#6b0408" stop-opacity="1" />
                </radialGradient>

                <linearGradient id="hl" x1="0" x2="1">
                  <stop offset="0%" stop-color="#ffffff" stop-opacity=".28" />
                  <stop offset="45%" stop-color="#ffffff" stop-opacity="0" />
                  <stop offset="100%" stop-color="#ffffff" stop-opacity=".10" />
                </linearGradient>

                <filter id="heartGlow" x="-40%" y="-40%" width="180%" height="180%">
                  <feGaussianBlur stdDeviation="1.3" result="b" />
                  <feMerge>
                    <feMergeNode in="b" />
                    <feMergeNode in="SourceGraphic" />
                  </feMerge>
                </filter>
              </defs>

              <!-- Base (anatomical-ish) -->
              <path filter="url(#heartGlow)" fill="url(#hg)" d="M34 8
             c4 1 6 4 7 8
             c1 4 0 8-2 12
             c3 2 5 6 5 10
             c0 6-3 11-7 15
             c-4 5-10 9-15 9
             c-5 0-9-3-10-8
             c-1-6 2-12 6-16
             c-2-3-2-7 0-10
             c2-3 6-4 9-3
             c2-5 4-9 7-12
             z" />

              <!-- Arterias/volumen -->
              <path fill="#8a0d12" opacity=".72" d="M41 10
             c3 2 4 6 3 10
             c-1 4-3 7-6 9
             c4 3 6 8 5 13
             c-2 8-10 16-18 18
             c7 1 15-5 19-11
             c4-6 6-13 3-19
             c-2-6-7-9-9-10
             z" />

              <!-- Brillo móvil (sheen) -->
              <path class="heartSheen" fill="url(#hl)" opacity=".65" d="M28 12
             c-2 3-4 6-5 9
             c-2 5-1 10 1 14
             c2 4 1 8-1 12
             c-2 4-3 8-2 11
             c1 4 4 6 7 7
             c-4-4-4-11-1-18
             c2-6 3-11 1-16
             c-2-6-1-12 0-19
             z" />

              <!-- Venitas -->
              <path fill="none" stroke="rgba(255,220,220,.28)" stroke-width="1.2" d="M35 20c-2 2-4 6-3 10
             M30 25c-3 3-4 7-2 12
             M37 30c-2 3-3 6-2 10" />
            </svg>
          </span>

          <a href="#" class="oathLink" id="btnYes" role="button" aria-label="Firmar y continuar el descenso">
            <span class="oathText">
              Así weno, <span class="oathEm">que arda el mundo</span> y se abra el telón.
            </span>
          </a>
        </div>

        <div class="oathHint soft">Toca la frase para firmar el descenso.</div>

        <!-- “Tinta” de firma (se anima al tocar) -->
        <svg class="inkSig" id="inkSig" viewBox="0 0 820 140" aria-hidden="true">
          <defs>
            <linearGradient id="inkG" x1="0" x2="1">
              <stop offset="0%" stop-color="rgba(255,42,42,.0)" />
              <stop offset="25%" stop-color="rgba(255,42,42,.85)" />
              <stop offset="55%" stop-color="rgba(255,120,120,.65)" />
              <stop offset="100%" stop-color="rgba(255,42,42,.0)" />
            </linearGradient>
            <filter id="inkBlur" x="-10%" y="-30%" width="120%" height="160%">
              <feGaussianBlur stdDeviation="1.6" />
            </filter>
          </defs>

          <!-- trazo grueso “mancha” -->
          <path class="inkFat" filter="url(#inkBlur)" d="M30 90
         C90 20, 160 130, 230 65
         C280 30, 340 120, 405 72
         C460 35, 520 110, 585 78
         C640 55, 700 98, 790 55" fill="none" stroke="rgba(255,42,42,.30)" stroke-width="12" stroke-linecap="round"
            stroke-linejoin="round" />

          <!-- trazo principal -->
          <path class="inkMain" d="M30 90
         C90 20, 160 130, 230 65
         C280 30, 340 120, 405 72
         C460 35, 520 110, 585 78
         C640 55, 700 98, 790 55" fill="none" stroke="url(#inkG)" stroke-width="6" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </div>


    </div>
  </section>

  <!-- App -->
  <div id="app" aria-hidden="true">
    <main id="stage">
      <div class="stageInner" id="stageInner">
        <h2 class="actTitle" id="actTitle"></h2>

        <p class="para fadeIn" id="para"></p>

        <div class="hint" id="hint">
          <div class="mouse" aria-hidden="true"></div>
          <div>Desliza / scroll para seguir descendiendo</div>
        </div>
      </div>
    </main>

    <!-- Player -->
    <footer id="player">
      <div class="thumb" aria-hidden="true">
        <!-- SVG: corazón roto en llamas -->
        <svg viewBox="0 0 64 64" role="img" aria-label="Corazón roto en llamas">
          <defs>
            <linearGradient id="gFlame" x1="0" x2="1" y1="1" y2="0">
              <stop offset="0" stop-color="#ff2a2a" />
              <stop offset="0.55" stop-color="#ff7b2a" />
              <stop offset="1" stop-color="#ffe6a0" />
            </linearGradient>
            <linearGradient id="gHeart" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0" stop-color="#ff2a2a" />
              <stop offset="1" stop-color="#8a0d12" />
            </linearGradient>
            <filter id="glow" x="-30%" y="-30%" width="160%" height="160%">
              <feGaussianBlur stdDeviation="1.2" result="b" />
              <feMerge>
                <feMergeNode in="b" />
                <feMergeNode in="SourceGraphic" />
              </feMerge>
            </filter>
          </defs>

          <!-- llamas -->
          <path filter="url(#glow)" fill="url(#gFlame)" d="M30 4c3 5-1 8-1 11 0 3 2 5 5 6-2 2-3 4-2 7 1 4 5 6 9 6
               0 0-2 3-6 4 2 2 3 4 3 7 0 5-5 9-11 9s-11-4-11-10
               c0-5 3-8 6-10-1-2-2-4-1-6 1-3 4-5 7-6-2-2-3-4-3-7
               0-3 3-6 5-11z" />

          <!-- corazón -->
          <path fill="url(#gHeart)" d="M32 55s-14-8-19-17c-3-6-1-15 6-18 5-2 9 0 13 4
               4-4 8-6 13-4 7 3 9 12 6 18-5 9-19 17-19 17z" />

          <!-- grieta -->
          <path fill="rgba(255,255,255,.82)" d="M34 18l-3 7 4 6-5 7 3 7-2 10" opacity=".55" />
        </svg>
      </div>

      <div class="track">
        <div class="marquee" aria-label="Título de canción">
          <!-- duplicamos para marquee fluido -->
          <div class="marqueeInner" id="marqueeInner">
            <span class="songTitle">Melodía del corazón para el descenso al infierno</span>
          </div>
        </div>
        <div class="songSub soft">Reproductor — como una promesa que no se detiene</div>
      </div>

      <div class="controls">
        <button class="iconBtn" id="playBtn" aria-label="Reproducir / Pausar">
          <svg id="playIcon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M8 5v14l11-7z"></path>
          </svg>
          <svg id="pauseIcon" viewBox="0 0 24 24" aria-hidden="true" style="display:none;">
            <path d="M6 5h4v14H6zm8 0h4v14h-4z"></path>
          </svg>
        </button>
      </div>

      <div class="progressWrap" aria-label="Progreso de canción">
        <div class="bar" id="bar" role="slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
          <div class="barFill" id="barFill"></div>
        </div>
        <div class="time" id="time">00:00 — 00:00</div>
      </div>

      <!-- Audio (pon tu archivo song.mp3 junto a este index.html) -->
      <audio id="audio" preload="metadata" src="song.mp3"></audio>
    </footer>
  </div>

  <!-- Burn -->
  <div id="burn" aria-hidden="true">
    <canvas id="flameCanvas"></canvas>
    <div id="burnFade"></div>
  </div>

  <!-- Night -->
  <div id="night" aria-hidden="true">
    <canvas id="skyCanvas"></canvas>
    <div id="nightGlow"></div>
    <img id="moon" src="moon.png" alt="Luna" />
    <div id="quote">
      <div class="hand">“Cuando tienes la luna enfrente de ti<br />no volteas a ver las estrellas”</div>
    </div>
  </div>

  <script>
    const ACTS = [
      {
        title: "El sueño que se cumplió",
        paragraphs: [
          `Las flores florecen y mueren, las estrellas brillan pero eventualmente se apagan,
          todo muere, la tierra, el sol, y hasta algo tan inmenso como esta universo no está excluido...
          <br>
          Comparado con eso, la vida de una persona es efímera como un abrir y cerrar de ojos, y justo en medio de ese parpadeo, <span class="accent">te conocí...</span>`,
          `No quiero sonar mal, pero supiste que me llamaste la atención desde el primer momento, 
          algo en ti que sabes que ninguna persona en su sano juicio dejaría ir la oportunidad de estar contigo.
          Eorque eres el capricho que jamás dejaría dejar pasar`,
          `Tal vez fue algo que tomó demasiados años lograr estar contigo en la forma en que estamos ahora,
          muchos errores y una gran cantidad de comunicación y confianza para llegar a este punto.
          <br>
          Tanto que al llegar a pensar en ello, <span class="accent">hubiera adelantado muchas cosas</span>.`,
          `Lamentablemente debido a muchas circunstancias, no se pudo lograr antes de lo que es ahora, 
          tal vez dirías tú, <span class="accent">que todo llega en su momento</span>. Y tienes razón.`,
          `Para tí todo fue aparte, para mí fue poder lograr algo que pensé que nunca podría tener, ese sueño imposible.
          <br>
          El aceptar que eso es el mundo de los bellos y que yo no podía estar ahí.`,
          `Así que es gracias a ti que descubrí que con una tremenda perseverancia y esfuerzo, los sueños imposibles pueden hacerse realidad.
          <br>
          Y por eso siempre te diré que <span class="accent">nos has salvado, estamos agradecidas</span>.`,
          `<span class="accent">Lo vivido contigo no será repetido con ninguna otra persona</span>.
         No por falta de caminos, sino porque ya no siento que tenga más que dar o que todo sería nuevamente en vano, 
         las personas ahora no les gusta la intensidad, y siempre tenemos que reprimir lo que somos, todo por no asustar a la otra.
         <br>
         Pero contigo fue diferente, <span class="accent">pude ser yo misma</span>, a pesar de que te sacaba de onda,
         que me trataras de alejar, que me dijeras "ora", siempre supe que solo era una ilusión.`,
          `Y aun sabiendo que a pesar de saber que todo estaba en mi cabeza, <span class="accent">¿Cómo eso iba a significar que no era real?.</span>
          <br>
          No me importa ser vulnerable contigo, porque has visto y sabes todo lo que he sufrido,
          mi curita del alma, mi voz, mi sí, mis te amos. Y pese a todo eso, y aún así sabiendo que no sería eterno,
         <span class="accent">el para siempre no sería suficiente</span>.`
        ]
      },
      {
        title: "El último respiro",
        paragraphs: [
          `Te pedí con el alma temblando: no me dejes con el amor en las manos.
         Y aun así, supe que quizá sería inevitable… como una puerta que tarde o temprano se cierra.
         <br>
         De tantas formas literales y figuradas, te entregué mi corazón. porque tenlo por seguro, <span class="accent">mi corazón siempre será tuyo</span>.`,
          `El día que <span class="accent">llegó alguien más a tu vida</span> no lo imaginé.
         No lo supe ver venir. Y cuando lo entendí… me rompió por dentro.`,
          `Te amé con toda mi fé sin medida cuando estabas compartida, porque solo así podía hacerlo, sin pertenencias ni ataduras.`,
          `Porque <span class="accent">te necesito más en mi vida de lo que podría pensar</span>.
         Y me aterra admitirlo, pero me aterra más lastimarte.`,
          `Y aunque supe cosas que dolieron, cosas tal vez no debí saber, no te reprocho nada.
         <span class="accent">Voy a seguir</span> y fingir que nunca pasaron.
         No por debilidad, sino por esta esperanza que me desangra.`,
         `A pesar de todo,seguiré siendo tu amigui, porque no puedo dejar de serlo. <span class="accent">Eres mi persona favorita</span>.'
          Aunque a veces me sienta como un fantasma en tu vida, una sombra que se asoma de vez en cuando.
          <br>
          Porque muchas veces no supe bien exactamente qué era para ti, porque no me sentía ni una cosa ni otra.`,
          `En el fondo no podría perdonarme no haberlo intentado todo por ti, <span class="accent">aunque eso me destruya</span>.
          Así que aquí estoy, dispuesta a todo por ti, aunque eso signifique perderme a mí misma. 
          Porque preferiría mil veces perder todo lo que tengo que perderte a ti.
          <br>
          Así que dejando la idea aquí, si 4 cifras no eran suficientes, podría ofrecer hasta 5 cifras, si eso fuera necesario.
          Aunque en el fondo sepa la respuesta...`
        ]
      },
      {
        title: "La aria eterna del corazón roto",
        paragraphs: [
          `Sé bien que <span class="accent">no soy nada</span>.
          ¿Y quién soy yo para hacerte sentir responsable del amor inútil que te tengo?.
          <br>
          A pesar de todo, permaneceré fiel a mis principios, porque fue mi señal que pedí a Dios, por eso
         no te dejaré de amar pase lo que pase. Que el mundo cambie, pero que no nos cambie a nosotras.`,
          `Y si un día me necesitas… estaré contigo. Siempre que me llames. Siempre que te falte aire.
         <span class="accent">Always.</span>`
        ]
      }
    ];

    // =========================
    // DOM
    // =========================
    const gate = document.getElementById("gate");
    const gateCard = document.getElementById("gateCard");
    const btnYes = document.getElementById("btnYes");

    const app = document.getElementById("app");
    const stageInner = document.getElementById("stageInner");

    const actTitle = document.getElementById("actTitle");
    const para = document.getElementById("para");
    const hint = document.getElementById("hint");

    const burn = document.getElementById("burn");
    const flameCanvas = document.getElementById("flameCanvas");

    const night = document.getElementById("night");
    const skyCanvas = document.getElementById("skyCanvas");

    // Player
    const audio = document.getElementById("audio");
    const playBtn = document.getElementById("playBtn");
    const playIcon = document.getElementById("playIcon");
    const pauseIcon = document.getElementById("pauseIcon");
    const bar = document.getElementById("bar");
    const barFill = document.getElementById("barFill");
    const time = document.getElementById("time");

    // =========================
    // Estado
    // =========================
    let actIndex = 0;
    let paraIndex = -1; // -1 = SOLO título del acto (después de cortina)
    let locked = false;
    let done = false;

    // =========================
    // Utils
    // =========================
    function wait(ms) { return new Promise(r => setTimeout(r, ms)); }

    // =========================
    // Render
    // =========================
    function render() {
      const act = ACTS[actIndex];
      actTitle.textContent = act.title;

      const titleOnly = (paraIndex === -1);
      stageInner.classList.toggle("titleOnly", titleOnly);

      if (!titleOnly) {
        para.innerHTML = act.paragraphs[paraIndex];

        // Animación suave en cada cambio
        para.classList.remove("fadeIn");
        void para.offsetWidth;
        para.classList.add("fadeIn");
      }

      // Hint SOLO en el primer párrafo del primer acto
      hint.style.display = (actIndex === 0 && paraIndex === -1) ? "flex" : "none";
      actTitle.style.display = (paraIndex === -1) ? "flex" : "none";
    }

    // =========================
    // Cortinas
    // =========================
    async function curtainTransition(swapFn) {
      document.body.classList.add("curtainsClosing");
      await wait(760);

      swapFn?.();

      window.scrollTo({ top: 0, left: 0, behavior: "instant" });

      document.body.classList.remove("curtainsClosing");
      await wait(760);
    }

    // =========================
    // Paso (scroll)
    // =========================
    async function next() {
      if (locked || done) return;
      locked = true;

      const act = ACTS[actIndex];

      // avanzar dentro del acto
      if (paraIndex < act.paragraphs.length - 1) {
        paraIndex++;
        render();
        await wait(520);
        locked = false;
        return;
      }

      // Fin de acto => siguiente acto
      if (actIndex < ACTS.length - 1) {
        await curtainTransition(() => {
          actIndex++;
          paraIndex = -1; // sólo título
          render();
        });
        locked = false;
        return;
      }

      // Fin total => burn
      done = true;
      await startBurnSequence();
    }

    async function prev() {
      if (locked || done) return;
      locked = true;

      if (paraIndex > -1) {
        paraIndex--;
        render();
        await wait(520);
        locked = false;
        return;
      }

      if (actIndex > 0) {
        await curtainTransition(() => {
          actIndex--;
          paraIndex = Math.max(-1, ACTS[actIndex].paragraphs.length - 1);
          render();
        });
        locked = false;
        return;
      }

      locked = false;
    }

    // =========================
    // Gate
    // =========================

    let entering = false;

    btnYes.addEventListener("click", async (e) => {
      e.preventDefault();
      if (entering) return;
      entering = true;

      // 1) Firma con tinta primero
      gateCard.classList.add("signing");

      // deja que la tinta se dibuje
      await wait(650);

      // 2) Ahora sí: cerrar cortina encima del gate
      document.body.classList.add("curtainsClosing");
      await wait(760);

      // 3) Swap oculto (cambiamos escena mientras está cerrado)
      app.setAttribute("aria-hidden", "false");
      gate.style.display = "none";

      actIndex = 0;
      paraIndex = -1;
      render();

      // 4) Abrir cortina
      document.body.classList.remove("curtainsClosing");
      await wait(760);

      await audio.play();
      setPlaying(true);

    });


    // =========================
    // Input: wheel / touch / teclado
    // =========================
    let wheelCooldown = 0;
    window.addEventListener("wheel", (e) => {
      if (done) return;
      const now = performance.now();

      if (now - wheelCooldown < 720) return;
      if (Math.abs(e.deltaY) < 12) return;

      wheelCooldown = now;

      if (e.deltaY > 0) next();
      else prev();
    }, { passive: true });

    let touchStartY = null;
    window.addEventListener("touchstart", (e) => {
      touchStartY = e.touches?.[0]?.clientY ?? null;
    }, { passive: true });

    window.addEventListener("touchend", (e) => {
      if (touchStartY == null) return;
      const endY = e.changedTouches?.[0]?.clientY ?? touchStartY;
      const dy = touchStartY - endY;
      touchStartY = null;

      if (Math.abs(dy) < 32) return;
      if (dy > 0) next();
      else prev();
    }, { passive: true });

    window.addEventListener("keydown", (e) => {
      if (done) return;
      if (e.key === "ArrowDown" || e.key === " " || e.key === "PageDown") next();
      if (e.key === "ArrowUp" || e.key === "PageUp") prev();
    });

    // =========================
    // Secuencia final
    // =========================
    async function startBurnSequence() {
      // 1) Cerrar telón y mantenerlo cerrado (evita ver el último acto otra vez)
      document.body.classList.add("curtainsClosing");
      await wait(760);

      // 2) Mostrar burn overlay mientras el telón sigue cerrado
      burn.classList.add("show");
      burn.setAttribute("aria-hidden", "false");
      burn.classList.remove("black");       // por si se reusara
      burn.style.display = "";              // asegura que no quede forzado en none

      startFlames();

      // 3) Ya no importa el telón: el burn está encima cubriendo todo
      // (puedes dejarlo cerrado, pero lo quitamos para no interferir con nada)
      document.body.classList.remove("curtainsClosing");

      // 4) Deja arder
      await wait(3600);

      // 5) Fade a negro
      burn.classList.add("black");
      await wait(1400);

      // 6) Cielo nocturno
      night.classList.add("show");
      night.setAttribute("aria-hidden", "false");

      // En mobile, mejor arrancar sky en el siguiente frame
      requestAnimationFrame(() => startSky());

      // 7) Ocultar burn
      burn.style.display = "none";
    }


    // =========================
    // Canvas: Llamas
    // =========================
    let flameRaf = null;
    function startFlames() {
      const ctx = flameCanvas.getContext("2d", { alpha: true });
      const dpr = Math.max(1, Math.min(2, devicePixelRatio || 1));

      function resize() {
        flameCanvas.width = Math.floor(innerWidth * dpr);
        flameCanvas.height = Math.floor(innerHeight * dpr);
      }
      resize();
      addEventListener("resize", resize, { passive: true });

      const W = () => flameCanvas.width;
      const H = () => flameCanvas.height;

      const particles = [];
      const MAX = 360;

      function spawn() {
        const x = (Math.random() * W());
        const y = H() + Math.random() * 40 * dpr;
        const vx = (Math.random() - 0.5) * 0.6 * dpr;
        const vy = -(1.2 + Math.random() * 2.2) * dpr;
        const life = 50 + Math.random() * 70;
        const size = (14 + Math.random() * 26) * dpr;
        particles.push({ x, y, vx, vy, life, age: 0, size, drift: (Math.random() - 0.5) * 0.04 });
      }

      function step() {
        ctx.fillStyle = "rgba(0,0,0,0.14)";
        ctx.fillRect(0, 0, W(), H());

        while (particles.length < MAX) spawn();

        for (let i = particles.length - 1; i >= 0; i--) {
          const p = particles[i];
          p.age++;
          p.vx += p.drift;
          p.x += p.vx;
          p.y += p.vy;
          p.vy *= 0.988;

          const t = p.age / p.life;
          const a = Math.max(0, 1 - t);
          const s = p.size * (0.75 + (1 - t) * 0.55);

          const r = 255;
          const g = Math.floor(60 + 170 * (1 - t));
          const b = Math.floor(35 + 90 * (1 - t));

          ctx.beginPath();
          ctx.fillStyle = `rgba(${r},${g},${b},${0.18 * a})`;
          ctx.ellipse(p.x, p.y, s * 0.6, s, 0, 0, Math.PI * 2);
          ctx.fill();

          ctx.beginPath();
          ctx.fillStyle = `rgba(255,240,200,${0.08 * a})`;
          ctx.ellipse(p.x, p.y + s * 0.15, s * 0.22, s * 0.42, 0, 0, Math.PI * 2);
          ctx.fill();

          if (p.age >= p.life || p.y < -80) {
            particles.splice(i, 1);
          }
        }

        flameRaf = requestAnimationFrame(step);
      }

      ctx.clearRect(0, 0, W(), H());
      step();
    }

    // =========================
    // Canvas: Cielo + estrellas ✨
    // =========================
    let skyRaf = null;
    function startSky() {
      const ctx = skyCanvas.getContext("2d");
      const dpr = Math.max(1, Math.min(2, devicePixelRatio || 1));

      const stars = [];
      const count = 240;

      function resize() {
        skyCanvas.width = Math.floor(innerWidth * dpr);
        skyCanvas.height = Math.floor(innerHeight * dpr);
      }

      function initStars() {
        stars.length = 0;
        const w = skyCanvas.width;
        const h = skyCanvas.height;

        for (let i = 0; i < count; i++) {
          const x = Math.random() * w;
          const y = Math.random() * h;
          const base = 0.35 + Math.random() * 0.65;
          const r = (0.9 + Math.random() * 2.2) * dpr;
          const phase = Math.random() * Math.PI * 2;
          const speed = 0.5 + Math.random() * 1.9;
          const kind = (Math.random() < 0.68) ? 1 : 0; // más ✨
          stars.push({ x, y, base, r, phase, speed, kind });
        }
      }

      function drawSparkle(x, y, size, a, rot) {
        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(rot);

        // Cruz principal
        ctx.strokeStyle = `rgba(230,245,255,${a * 0.60})`;
        ctx.lineWidth = Math.max(1, size * 0.22);
        ctx.lineCap = "round";
        ctx.beginPath();
        ctx.moveTo(0, -size); ctx.lineTo(0, size);
        ctx.moveTo(-size, 0); ctx.lineTo(size, 0);
        ctx.stroke();

        // Diagonales pequeñas (✨)
        const d = size * 0.55;
        ctx.strokeStyle = `rgba(230,245,255,${a * 0.35})`;
        ctx.lineWidth = Math.max(1, size * 0.14);
        ctx.beginPath();
        ctx.moveTo(-d, -d); ctx.lineTo(d, d);
        ctx.moveTo(-d, d); ctx.lineTo(d, -d);
        ctx.stroke();

        // Núcleo
        ctx.fillStyle = `rgba(255,255,255,${a})`;
        ctx.beginPath();
        ctx.arc(0, 0, Math.max(1, size * 0.12), 0, Math.PI * 2);
        ctx.fill();

        ctx.restore();
      }

      resize();
      initStars();
      addEventListener("resize", () => { resize(); initStars(); }, { passive: true });

      const start = performance.now();
      function draw(now) {
        const t = (now - start) / 1000;
        const w = skyCanvas.width;
        const h = skyCanvas.height;

        const fade = Math.min(1, t / 2.2);

        // Fondo
        ctx.fillStyle = "rgba(0,0,0,1)";
        ctx.fillRect(0, 0, w, h);

        // Bruma azul
        ctx.fillStyle = `rgba(20,60,130,${0.30 * fade})`;
        ctx.fillRect(0, 0, w, h);

        // Estrellas
        for (const s of stars) {
          const pulse = 0.55 + 0.45 * Math.sin(s.phase + t * s.speed);
          const flicker = 0.85 + 0.15 * Math.sin((s.phase * 7.3) + t * (s.speed * 2.3));
          const a = (0.20 + 0.74 * s.base * pulse) * fade * flicker;

          if (s.kind === 1) {
            drawSparkle(s.x, s.y, s.r * (1.8 + 1.1 * pulse), a, s.phase + t * 0.18);
          } else {
            ctx.beginPath();
            ctx.fillStyle = `rgba(230,245,255,${a * 0.85})`;
            ctx.arc(s.x, s.y, s.r * (0.8 + 0.5 * pulse), 0, Math.PI * 2);
            ctx.fill();
          }
        }

        skyRaf = requestAnimationFrame(draw);
      }

      requestAnimationFrame(draw);
    }

    // =========================
    // Player
    // =========================
    function fmt(sec) {
      if (!isFinite(sec)) return "00:00";
      sec = Math.max(0, Math.floor(sec));
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return String(m).padStart(2, "0") + ":" + String(s).padStart(2, "0");
    }

    function syncUI() {
      const cur = audio.currentTime || 0;
      const dur = audio.duration || 0;
      const pct = dur ? (cur / dur) * 100 : 0;
      barFill.style.width = pct + "%";
      bar.setAttribute("aria-valuenow", String(Math.round(pct)));
      time.textContent = `${fmt(cur)} — ${fmt(dur)}`;
    }

    function setPlaying(isPlaying) {
      playIcon.style.display = isPlaying ? "none" : "block";
      pauseIcon.style.display = isPlaying ? "block" : "none";
    }

    playBtn.addEventListener("click", async () => {
      try {
        if (audio.paused) {
          await audio.play();
          setPlaying(true);
        } else {
          audio.pause();
          setPlaying(false);
        }
      } catch (e) {
        setPlaying(false);
      }
    });

    audio.addEventListener("play", () => setPlaying(true));
    audio.addEventListener("pause", () => setPlaying(false));
    audio.addEventListener("timeupdate", syncUI);
    audio.addEventListener("loadedmetadata", syncUI);

    bar.addEventListener("click", (e) => {
      const rect = bar.getBoundingClientRect();
      const x = Math.min(rect.width, Math.max(0, e.clientX - rect.left));
      const pct = rect.width ? (x / rect.width) : 0;
      if (isFinite(audio.duration)) {
        audio.currentTime = pct * audio.duration;
        syncUI();
      }
    });
  </script>

</body>

</html>